# Render.com Configuration for WritgoAI
# https://render.com/docs/yaml-spec

services:
  # Main Web Application
  - type: web
    name: writgoai-web
    env: node
    region: frankfurt
    plan: starter
    buildCommand: cd nextjs_space && npm install && npm run build
    startCommand: cd nextjs_space && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - fromGroup: writgoai-env
    healthCheckPath: /api/health
    
  # Cron Job 1: Daily Content Generation (9:00 UTC = 10:00 CET)
  - type: cron
    name: writgoai-daily-content
    env: node
    region: frankfurt
    schedule: "0 9 * * *"  # Every day at 9:00 UTC
    buildCommand: echo "Cron job - no build needed"
    startCommand: |
      curl -X POST \
        -H "Authorization: Bearer $CRON_SECRET" \
        -H "Content-Type: application/json" \
        $NEXTAUTH_URL/api/cron/daily-content-generation
    envVars:
      - fromGroup: writgoai-env
      
  # Cron Job 2: Publish Scheduled Articles (every hour)
  - type: cron
    name: writgoai-publish-scheduled
    env: node
    region: frankfurt
    schedule: "0 * * * *"  # Every hour
    buildCommand: echo "Cron job - no build needed"
    startCommand: |
      curl -X POST \
        -H "Authorization: Bearer $CRON_SECRET" \
        -H "Content-Type: application/json" \
        $NEXTAUTH_URL/api/cron/publish-scheduled-articles
    envVars:
      - fromGroup: writgoai-env

  # Cron Job 3: Autopilot Projects (twice daily: 6:00 and 18:00 UTC)
  - type: cron
    name: writgoai-autopilot-morning
    env: node
    region: frankfurt
    schedule: "0 6 * * *"  # Every day at 6:00 UTC (morning)
    buildCommand: echo "Cron job - no build needed"
    startCommand: |
      curl -X POST \
        -H "Authorization: Bearer $CRON_SECRET" \
        -H "Content-Type: application/json" \
        $NEXTAUTH_URL/api/cron/autopilot-projects
    envVars:
      - fromGroup: writgoai-env

  - type: cron
    name: writgoai-autopilot-evening
    env: node
    region: frankfurt
    schedule: "0 18 * * *"  # Every day at 18:00 UTC (evening)
    buildCommand: echo "Cron job - no build needed"
    startCommand: |
      curl -X POST \
        -H "Authorization: Bearer $CRON_SECRET" \
        -H "Content-Type: application/json" \
        $NEXTAUTH_URL/api/cron/autopilot-projects
    envVars:
      - fromGroup: writgoai-env

# Environment Variable Groups
# Note: Create this group in Render Dashboard with all environment variables
envVarGroups:
  - name: writgoai-env
    envVars:
      - key: NEXTAUTH_URL
        sync: false  # Set manually in Render Dashboard
      - key: NEXTAUTH_SECRET
        sync: false
      - key: CRON_SECRET
        generateValue: true
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: AIML_API_KEY
        sync: false
      - key: LATE_DEV_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
