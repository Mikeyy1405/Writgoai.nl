// Nieuwe simpele database schema voor dagelijkse content automatisering

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Admin users die de app beheren
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("admin")
  videos    Video[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Klanten die content automatisering willen
model Client {
  id          String  @id @default(cuid())
  email       String  @unique
  name        String
  companyName String?
  website     String?
  password    String

  // Relaties naar projecten
  projects Project[]

  // Credit systeem - Twee types credits
  subscriptionCredits   Float   @default(0) // Maandelijkse credits van abonnement (vernieuwd elke maand)
  topUpCredits          Float   @default(0) // Eenmalig gekochte credits (blijven beschikbaar)
  isUnlimited           Boolean @default(false) // Voor speciale accounts (mikeschonewille, cgrotebeverborg)
  totalCreditsUsed      Float   @default(0) // Totaal gebruikte credits
  totalCreditsPurchased Float   @default(0) // Totaal gekochte credits

  // Subscription systeem
  subscriptionId        String?   @unique // Stripe subscription ID
  subscriptionPlan      String? // starter, pro, business
  subscriptionStatus    String? // active, cancelled, past_due, trialing
  subscriptionStartDate DateTime?
  subscriptionEndDate   DateTime?
  monthlyCredits        Float? // Maandelijkse credits die je krijgt

  // Automation settings
  automationActive    Boolean   @default(false)
  automationStartDate DateTime?
  targetAudience      String?
  brandVoice          String?
  keywords            String[]

  // WordPress credentials voor publicatie
  wordpressUrl         String?
  wordpressUsername    String?
  wordpressPassword    String?
  wordpressSitemap     Json? // Sitemap data: categories, tags, recentPosts
  wordpressSitemapDate DateTime? // Last sitemap fetch date

  // Content planning
  contentPlan       Json? // AI-generated content plan (30 days)
  lastPlanGenerated DateTime? // When was the plan last generated

  // Late.dev integration (unified social media posting)
  lateDevProfileId String? // Late.dev profile ID for this client

  // Legacy OAuth credentials (deprecated - gebruik Late.dev)
  youtubeChannelId    String?
  youtubeApiKey       String?
  youtubeAccessToken  String?   @db.Text
  youtubeRefreshToken String?   @db.Text
  youtubeTokenExpiry  DateTime?
  youtubeChannelName  String?
  youtubeConnected    Boolean   @default(false)

  tiktokOpenId       String?
  tiktokAccessToken  String?   @db.Text
  tiktokRefreshToken String?   @db.Text
  tiktokTokenExpiry  DateTime?
  tiktokUsername     String?
  tiktokConnected    Boolean   @default(false)

  facebookAccessToken String? @db.Text
  facebookPageId      String?
  facebookPageName    String?
  facebookConnected   Boolean @default(false)

  instagramAccessToken String? @db.Text
  instagramAccountId   String?
  instagramUsername    String?
  instagramConnected   Boolean @default(false)

  linkedinPageId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaties
  contentPieces       ContentPiece[]
  savedContent        SavedContent[]
  contentCategories   ContentCategory[]
  lateDevAccounts     LateDevAccount[]
  videos              Video[]
  conversations       Conversation[]
  aiSettings          ClientAISettings?
  creditTransactions  CreditTransaction[]
  creditPurchases     CreditPurchase[]
  taskRequests        TaskRequest[]
  messages            DirectMessage[]
  socialMediaAccounts SocialMediaAccount[]
  calendarItems       ContentCalendarItem[]
  savedKeywords       Keyword[]
  articleIdeas        ArticleIdea[]
  autoPilotJobs       AutoPilotJob[]
}

// Project/Website voor elke client (kan meerdere websites/projecten hebben)
model Project {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Basis project info
  name        String // Project naam (bijv. "Writgo.nl", "YogaStartGids")
  websiteUrl  String // Volledige URL (https://writgo.nl)
  description String? @db.Text // Korte omschrijving van het project

  // Website scan data
  sitemap          Json? // Sitemap structuur (categories, pages, posts)
  sitemapScannedAt DateTime? // Laatste scan datum

  // AI Website Analysis
  targetAudience String?  @db.Text // Doelgroep analyse
  brandVoice     String?  @db.Text // Tone of voice
  niche          String? // Primaire niche
  keywords       String[] // SEO keywords
  contentPillars String[] // Content pillars/thema's

  // Uitgebreide Anamnese Velden
  businessGoals       String? @db.Text // Bedrijfsdoelen
  uniqueSellingPoints String? @db.Text // USP's
  competitors         String? @db.Text // Concurrenten
  contentTopics       String? @db.Text // Content onderwerpen
  currentChallenges   String? @db.Text // Huidige uitdagingen
  desiredOutcome      String? @db.Text // Gewenst resultaat
  timeline            String? // Gewenste timeline
  budget              String? // Budget indicatie
  socialMediaChannels String? // Social media kanalen
  additionalInfo      String? @db.Text // Overige opmerkingen

  // Schrijfstijl & Personalisatie
  writingStyle       String? @db.Text // Gewenste schrijfstijl (formeel, casual, vriendelijk, etc.)
  customInstructions String? @db.Text // Extra instructies voor AI (SEO regels, do's en don'ts)
  personalInfo       Json? // Persoonlijke info (eigenaar naam, expertise, verhalen, etc.)

  // Affiliate Links & Monetization
  // Affiliate links zijn nu in aparte tabel (zie AffiliateLink model)
  preferredProducts String[] // Producten om te promoten

  // Internal Linking Strategy
  importantPages    Json? // Array of { title: string, url: string, description: string }
  linkingGuidelines String? @db.Text // Richtlijnen voor interne links

  // WordPress Integration (optioneel per project)
  wordpressUrl         String?
  wordpressUsername    String?
  wordpressPassword    String?
  wordpressCategory    String? // Standaard categorie voor posts
  wordpressAutoPublish Boolean @default(false) // Automatisch publiceren

  // Status
  isActive  Boolean @default(true)
  isPrimary Boolean @default(false) // Is dit het hoofdproject van de client

  // Relaties
  savedContent   SavedContent[]
  knowledgeBase  ProjectKnowledge[]
  affiliateLinks AffiliateLink[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([websiteUrl])
}

// Project Knowledge Base - Documenten en notities per project
model AffiliateLink {
  id        String  @id @default(cuid())
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  // Link info
  url         String   @db.Text // De affiliate URL
  anchorText  String // Anchor text voor de link
  category    String? // Categorie (bijv. "Yoga", "Qigong")
  description String?  @db.Text // Optionele beschrijving
  keywords    String[] // Relevante keywords voor matching

  // Metadata
  isActive   Boolean   @default(true)
  usageCount Int       @default(0) // Hoe vaak gebruikt in content
  lastUsedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
  @@index([category])
  @@index([keywords])
}

model ProjectKnowledge {
  id        String  @id @default(cuid())
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  // Knowledge item info
  title   String // Titel van het document/notitie
  type    String // document, note, guideline, faq, example
  content String @db.Text // De inhoud

  // Metadata
  category   String? // Categorisering (style_guide, seo_rules, brand_info, etc.)
  tags       String[] // Tags voor easy filtering
  importance String   @default("normal") // low, normal, high - hoe belangrijk is dit voor de AI

  // Voor documenten
  fileUrl  String? // Als het een geüpload document is
  fileType String? // pdf, docx, txt, etc.
  fileSize Int? // In bytes

  // Status
  isActive Boolean @default(true) // Moet de AI hier rekening mee houden?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
  @@index([type])
  @@index([importance])
  @@index([isActive])
}

// Late.dev connected social media accounts
model LateDevAccount {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  accountId         String // Late.dev account ID
  platform          String // instagram, tiktok, youtube, twitter, facebook, linkedin, threads, reddit, pinterest, bluesky
  platformAccountId String // Platform-specific account ID  
  username          String? // Display name/username
  avatar            String? // Profile picture URL

  connected   Boolean   @default(true)
  connectedAt DateTime  @default(now())
  lastUsed    DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([clientId, platformAccountId])
  @@index([clientId])
  @@index([platform])
}

// Gegenereerde content (blog, social, video) - Dagelijks
model ContentPiece {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Content planning
  dayNumber    Int // Dag nummer in het plan (1-7)
  theme        String // Hoofdthema van de dag
  scheduledFor DateTime // Wanneer moet het gepubliceerd worden

  // Blog content (HTML format voor WordPress)
  blogTitle         String?
  blogContent       String?   @db.Text // Volledige HTML content
  blogKeywords      String[] // SEO keywords
  blogMetaDesc      String?
  blogImages        String[] // URLs van afbeeldingen in blog
  blogInternalLinks Json? // { "anchor": "url" } pairs
  blogPublished     Boolean   @default(false)
  blogPublishedAt   DateTime?
  blogUrl           String?
  blogWordpressId   Int? // WordPress post ID

  // Social media post (Instagram feed post)
  socialCaption     String?   @db.Text
  socialHashtags    String[]
  socialImageUrl    String? // DALL-E 3 generated image
  socialImagePrompt String? // Prompt gebruikt voor afbeelding
  socialPublished   Boolean   @default(false)
  socialPublishedAt DateTime?
  socialPlatforms   String[] // Welke platforms (instagram, facebook, linkedin, etc)
  socialLateDevId   String? // Late.dev post ID

  // Reel/Video content (via Vadoo API)
  reelScript       String?   @db.Text // Voice-over script
  reelTitle        String? // Titel voor YouTube/TikTok
  reelHooks        String[] // Opening hooks (eerste 3 seconden)
  reelHashtags     String[]
  reelDuration     Int? // Geschatte duur in seconden
  reelVideoUrl     String? // URL naar gegenereerde video (van Vadoo)
  reelThumbnailUrl String? // Thumbnail van video
  reelVadooId      String? // Vadoo video ID
  reelVideoStatus  String?   @default("pending") // pending, generating, completed, failed
  reelPublished    Boolean   @default(false)
  reelPublishedAt  DateTime?
  reelPlatforms    String[] // tiktok, youtube, instagram

  // Status tracking
  status      String    @default("generating") // generating, draft, ready_for_review, published, failed
  generatedAt DateTime?
  reviewedAt  DateTime?
  publishedAt DateTime?

  // Error handling
  error      String? @db.Text
  retryCount Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([scheduledFor])
  @@index([status])
  @@index([dayNumber])
}

model Video {
  id           String  @id @default(cuid())
  vid          String  @unique // Vadoo video ID
  topic        String
  script       String  @db.Text
  language     String  @default("Dutch")
  voiceId      String? // Optional - Vadoo handles voice selection
  style        String  @default("Cinematic")
  duration     String  @default("30-60")
  status       String  @default("processing") // processing, completed, failed
  videoUrl     String?
  thumbnailUrl String?
  error        String? @db.Text

  // Relations
  clientId String?
  client   Client? @relation(fields: [clientId], references: [id], onDelete: Cascade)
  userId   String?
  user     User?   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([userId])
  @@index([status])
}

// AI Agent Chat Conversations
model Conversation {
  id       String @id @default(cuid())
  title    String @default("Nieuw gesprek")
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  messages ChatMessage[]

  isPinned   Boolean @default(false)
  isArchived Boolean @default(false)

  lastMessageAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([clientId])
  @@index([lastMessageAt])
}

// Background jobs voor achtergrond verwerking (bij netwerk errors, etc.)
model BackgroundJob {
  id             String  @id @default(cuid())
  clientId       String
  conversationId String? // Optioneel: link naar conversatie

  type   String // blog_generation, video_generation, etc.
  status String @default("pending") // pending, processing, completed, failed

  // Input data
  input Json // Alle input data voor de job

  // Output data
  output Json? // Resultaten van de job
  error  String? @db.Text

  // Progress tracking
  progress    Int     @default(0) // 0-100
  currentStep String? // Huidige stap

  // Retry logic
  retryCount Int @default(0)
  maxRetries Int @default(3)

  // Timestamps
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([clientId])
  @@index([status])
  @@index([type])
}

// Individual messages in conversations
model ChatMessage {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  role    String // user, assistant, system
  content String @db.Text

  // AI metadata
  model     String? // Which AI model was used
  toolCalls Json? // Tools that were called
  images    String[] // Generated images
  videos    Json? // Generated videos

  createdAt DateTime @default(now())

  @@index([conversationId])
  @@index([createdAt])
}

// Client AI Settings (Custom Instructions & Preferences)
model ClientAISettings {
  id       String @id @default(cuid())
  clientId String @unique
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Personalisatie
  nickname           String? // Bijnaam zoals "Writgo Media schrijver"
  customInstructions String? @db.Text // Custom instructions (zoals SEO regels)

  // AI Model voorkeuren
  preferredModel  String  @default("gpt-4") // gpt-4, claude-3-opus, gemini-pro, etc
  temperature     Float   @default(0.7) // Creativiteit (0-1)
  enableWebSearch Boolean @default(true) // Web search toestaan
  enableImageGen  Boolean @default(true) // Afbeeldingen genereren
  enableVideoGen  Boolean @default(true) // Videos genereren

  // Tone of voice preferences
  toneOfVoice  String? // professional, casual, friendly, etc
  writingStyle String? // descriptive, concise, storytelling, etc

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Credit Transaction Log (elke keer dat credits gebruikt worden)
model CreditTransaction {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  amount      Float // Aantal credits (negatief voor gebruik, positief voor aankoop)
  type        String // 'usage' | 'purchase' | 'refund' | 'bonus'
  description String // Bijv. "Chat message", "Image generation", etc.

  // AI Usage metadata
  model      String? // Welk AI model werd gebruikt
  tokensUsed Int? // Aantal tokens gebruikt
  messageId  String? // Link naar ChatMessage als van toepassing

  balanceAfter Float // Saldo na deze transactie

  createdAt DateTime @default(now())

  @@index([clientId])
  @@index([createdAt])
  @@index([type])
}

// Credit Purchase (wanneer klant credits koopt)
model CreditPurchase {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  packageId   String // Welk pakket
  packageName String // Naam van pakket
  credits     Float // Aantal credits gekocht
  priceEur    Float // Prijs in EUR

  // Stripe payment info
  stripePaymentId String? @unique
  stripeSessionId String?
  paymentStatus   String  @default("pending") // pending, completed, failed, refunded

  createdAt   DateTime  @default(now())
  completedAt DateTime?

  @@index([clientId])
  @@index([stripePaymentId])
  @@index([paymentStatus])
}

// Credit Package Definitions (wat we verkopen)
model CreditPackage {
  id       String  @id @default(cuid())
  name     String  @unique
  credits  Float // Aantal credits
  priceEur Float // Prijs in EUR
  discount Int     @default(0) // Percentage korting
  popular  Boolean @default(false)
  active   Boolean @default(true)

  description String?
  features    String[] // Extra features/voordelen

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Subscription plannen
model SubscriptionPlan {
  id             String  @id @default(cuid())
  name           String  @unique // starter, pro, business
  displayName    String // "Starter Plan", "Pro Plan", etc.
  monthlyCredits Float // Credits per maand
  priceEur       Float // Prijs per maand in EUR
  popular        Boolean @default(false)
  active         Boolean @default(true)

  description String?
  features    String[] // Extra features/voordelen

  stripePriceId String? // Stripe Price ID voor recurring payment

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Opdracht/Taak aanvragen door klanten
model TaskRequest {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Type opdracht
  taskType String // article, video, website, social_media, keyword_research, ai_app, custom

  // Aanvraag details
  title       String // Korte titel van opdracht
  description String @db.Text // Gedetailleerde beschrijving

  // Specificaties (worden door AI chat verzameld)
  specifications Json? // { wordCount, keywords, style, duration, etc. }

  // Pricing
  estimatedCost Float? // Geschatte kosten in euro
  creditCost    Float? // Kosten in credits
  priceApproved Boolean @default(false) // Heeft klant prijs geaccepteerd

  // Status tracking
  status   String @default("pending") // pending, approved, in_progress, completed, cancelled
  priority String @default("normal") // low, normal, high, urgent

  // Deadlines
  requestedDeadline DateTime?
  actualDeadline    DateTime?
  completedAt       DateTime?

  // Deliverables
  deliverables Json? // URLs, content, etc.
  feedback     String? @db.Text

  // Admin notes
  adminNotes String? @db.Text
  assignedTo String? // Admin email

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([status])
  @@index([taskType])
}

// Directe berichten tussen admin en klant
model DirectMessage {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  fromRole  String // "client" of "admin"
  fromName  String // Naam van afzender
  fromEmail String // Email van afzender

  subject String? // Optioneel onderwerp
  message String  @db.Text

  isRead Boolean   @default(false)
  readAt DateTime?

  // Attachments
  attachments String[] // URLs naar bestanden

  // Thread support
  replyToId String?
  replyTo   DirectMessage?  @relation("MessageReplies", fields: [replyToId], references: [id], onDelete: SetNull)
  replies   DirectMessage[] @relation("MessageReplies")

  createdAt DateTime @default(now())

  @@index([clientId])
  @@index([fromRole])
  @@index([isRead])
  @@index([createdAt])
}

// Content Library - Alle gegenereerde content opslaan voor later
model SavedContent {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Content type
  type        String // 'blog', 'social', 'video', 'code', 'other'
  title       String
  content     String  @db.Text
  contentHtml String? @db.Text // Voor blog posts

  // Metadata
  category    String? // 'marketing', 'seo', 'tutorial', 'news', etc.
  tags        String[] // Custom tags voor filtering
  description String?  @db.Text

  // SEO & Publishing
  keywords String[]
  metaDesc String?
  slug     String?

  // Images & Media
  thumbnailUrl String?
  imageUrls    String[]

  // Status
  isFavorite   Boolean   @default(false)
  isArchived   Boolean   @default(false)
  publishedUrl String? // Als het ergens gepubliceerd is
  publishedAt  DateTime?

  // Stats
  wordCount      Int?
  characterCount Int?

  // Project relation (optional)
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([type])
  @@index([category])
  @@index([isFavorite])
  @@index([isArchived])
  @@index([createdAt])
}

// Categories voor content organisatie
model ContentCategory {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  name        String
  description String?
  color       String? // Hex kleur voor UI
  icon        String? // Emoji of icon naam

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([clientId, name])
  @@index([clientId])
}

// Social Media Accounts - Connected via GetLate.dev
model SocialMediaAccount {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  platform      String // instagram, linkedin, facebook, twitter, tiktok, youtube, threads, reddit, pinterest, bluesky
  accountName   String? // Display name of the account
  accountHandle String? // @username or handle
  profileId     String // GetLate.dev profile ID
  accountId     String? // Platform-specific account ID

  isActive Boolean @default(true)

  // GetLate.dev specific
  lateDevData Json? // Store any additional platform-specific data

  connectedAt DateTime  @default(now())
  lastUsedAt  DateTime?

  @@unique([clientId, platform, profileId])
  @@index([clientId])
  @@index([platform])
}

// Content Calendar for scheduling social media posts
model ContentCalendarItem {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  title   String
  content String @db.Text

  // Media
  mediaType  String? // image, video, none
  mediaUrl   String? // URL to the generated media
  mediaStyle String? // Style used for generation

  // Scheduling
  scheduledFor DateTime
  publishedAt  DateTime?
  status       String    @default("scheduled") // scheduled, published, failed, cancelled

  // Platforms to publish to
  platforms String[] // Array of platform names

  // GetLate.dev
  lateDevPostId   String? // ID from GetLate.dev after scheduling
  lateDevResponse Json? // Response from GetLate.dev

  // Settings
  includeHashtags Boolean @default(true)
  includeEmojis   Boolean @default(true)
  tone            String?

  // Storytelling
  isStorytelling Boolean @default(false)
  storyType      String? // hero-journey, problem-solution, before-after, etc

  // Error tracking
  errorMessage String?
  retryCount   Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([scheduledFor])
  @@index([status])
  @@index([publishedAt])
}

// Keyword Research - Voor SEO en content planning
model Keyword {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Keyword data
  keyword      String
  searchVolume Int? // Estimated monthly search volume
  difficulty   Int? // SEO difficulty (0-100)
  cpc          Float? // Cost per click (if available)
  competition  String? // low, medium, high
  intent       String? // informational, transactional, navigational, commercial

  // Analysis
  currentRanking Int? // Current ranking position for this keyword
  potentialScore Int? // AI-calculated potential score (0-100)
  relevance      String? // How relevant is this keyword to the client
  category       String? // Category/topic of the keyword

  // Related keywords
  relatedKeywords String[] // Array of related keywords
  questions       String[] // Array of questions people ask

  // Content generation
  hasContent   Boolean  @default(false) // Has content been created for this keyword
  contentId    String? // Link to SavedContent if content was generated
  contentIdeas String[] // AI-generated content ideas for this keyword

  // Metadata
  source   String? // Where this keyword came from (website-scan, ai-suggestion, manual)
  notes    String? @db.Text
  isSaved  Boolean @default(true) // Is this keyword saved by the user
  priority String  @default("medium") // low, medium, high

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([keyword])
  @@index([priority])
  @@index([hasContent])
}

// Content Kalender - Voor volledige jaar planning van 400+ artikelen
model ArticleIdea {
  id       String @id @default(cuid())
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Artikel planning
  title        String // Volledige artikel titel
  slug         String // URL-friendly slug
  focusKeyword String // Primaire focus keyword
  topic        String @db.Text // Onderwerp/beschrijving

  // SEO & Keywords
  secondaryKeywords String[] // Extra keywords
  searchIntent      String? // informational, transactional, commercial, navigational
  searchVolume      Int? // Geschat zoekvolume
  difficulty        Int? // SEO moeilijkheid (0-100)

  // Content structuur
  contentOutline  Json? // H2/H3 structuur: {sections: [{heading, subpoints}]}
  targetWordCount Int? // Geschat aantal woorden
  contentType     String? // guide, listicle, howto, review, comparison

  // Interne linking strategie
  internalLinks   Json? // Voorgestelde interne links: [{anchor, url, page}]
  relatedArticles String[] // IDs van gerelateerde artikel ideeën

  // Media suggesties
  imageIdeas String[] // Beschrijvingen van afbeeldingen
  videoIdeas String[] // YouTube video suggesties/zoektermen

  // Planning & Status
  priority     String    @default("medium") // low, medium, high
  category     String? // Categorie/niche
  cluster      String? // Content cluster/pillar
  scheduledFor DateTime? // Geplande schrijfdatum
  status       String    @default("idea") // idea, queued, writing, completed, published

  // Generatie metadata
  hasContent  Boolean   @default(false)
  contentId   String? // Link naar SavedContent
  generatedAt DateTime? // Wanneer is het artikel gegenereerd
  publishedAt DateTime? // Wanneer is het gepubliceerd

  // AI metadata
  aiScore       Int? // AI-calculated potential score (0-100)
  trending      Boolean @default(false) // Is dit een trending topic
  seasonal      Boolean @default(false) // Is dit seizoensgebonden
  competitorGap Boolean @default(false) // Missen concurrenten dit

  // Notities
  notes String? @db.Text

  // AutoPilot scheduling
  isScheduledForAutopilot Boolean   @default(false)
  autopilotFrequency      String? // 'once' | 'daily' | 'weekly' | 'monthly'
  autopilotNextRun        DateTime?
  autopilotLastRun        DateTime?
  autopilotRunCount       Int       @default(0)

  // Research data (cached)
  perplexityResearch Json? // PerplexityResearchResult
  researchedAt       DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([focusKeyword])
  @@index([status])
  @@index([priority])
  @@index([scheduledFor])
  @@index([category])
  @@index([cluster])
  @@index([autopilotNextRun])
}

// WordPress Sites Management - Multi-site support voor content publicatie
model WordPressSite {
  id                  String @id @default(cuid())
  name                String // Friendly name (bijv. "Hoofdwebsite", "Blog Site")
  url                 String // WordPress site URL (bijv. "https://example.com")
  username            String // WordPress username
  applicationPassword String // WordPress Application Password
  apiEndpoint         String // WordPress REST API endpoint (bijv. "https://example.com/wp-json")

  // Optional: Link to specific user or agency
  userId   String?
  agencyId String?

  // Metadata
  isActive     Boolean   @default(true)
  lastTestedAt DateTime?
  testStatus   String? // success, failed, pending
  testMessage  String?   @db.Text

  // Relations
  publishedContent PublishedContent[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([agencyId])
  @@index([isActive])
}

// Published Content Tracking - Tracks all content published to WordPress
model PublishedContent {
  id String @id @default(cuid())

  // WordPress Site relation
  wordPressSiteId String
  wordPressSite   WordPressSite @relation(fields: [wordPressSiteId], references: [id], onDelete: Cascade)

  // Content info
  title       String
  content     String @db.Text
  contentHtml String @db.Text

  // WordPress metadata
  wordpressPostId Int // WordPress post ID
  wordpressUrl    String? // Published URL
  wordpressStatus String  @default("publish") // draft, publish, pending

  // SEO
  keywords        String[]
  metaDescription String?
  focusKeyword    String?

  // Bol.com products embedded
  bolProducts Json? // Array of embedded Bol.com products

  // Publishing metadata
  publishedBy   String? // User ID who published
  publishMethod String  @default("manual") // manual, automated

  // Stats
  wordCount Int?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  publishedAt DateTime @default(now())

  @@index([wordPressSiteId])
  @@index([wordpressPostId])
  @@index([publishedAt])
}

// AutoPilot Job - Tracks autonomous content generation jobs
model AutoPilotJob {
  id            String @id @default(cuid())
  clientId      String
  projectId     String
  articleIdeaId String

  status      String // 'pending' | 'researching' | 'writing' | 'generating_image' | 'publishing' | 'completed' | 'failed'
  progress    Float   @default(0)
  currentStep String?

  // Results
  contentId       String?
  wordpressPostId Int?
  wordpressUrl    String?

  // Metadata
  error       String?   @db.Text
  startedAt   DateTime  @default(now())
  completedAt DateTime?
  result      Json? // Full result object

  client Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([status])
  @@index([startedAt])
}

// Content Optimization Log - Tracks content optimization history
model ContentOptimizationLog {
  id              String @id @default(cuid())
  projectId       String
  wordpressPostId Int

  originalSeoScore Float
  newSeoScore      Float
  improvements     String[]

  optimizedAt DateTime @default(now())

  @@index([projectId])
  @@index([optimizedAt])
}
