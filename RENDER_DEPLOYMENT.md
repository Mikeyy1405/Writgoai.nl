# ðŸš€ Render Deployment Guide voor Writgo AI

Complete handleiding voor het deployen van Writgo AI op Render met PostgreSQL database.

## ðŸ“‹ Vereisten Checklist

- [ ] GitHub account met toegang tot de Writgo AI repository
- [ ] Render account (aanmelden op [render.com](https://render.com))
- [ ] Alle vereiste API keys beschikbaar (zie Environment Variables sectie)
- [ ] Domein writgoai.nl DNS toegang (voor custom domain setup)

## ðŸ—„ï¸ Stap 1: Database Setup

### Optie A: Via Render Dashboard (Aanbevolen voor beginners)

1. **Log in op Render Dashboard**
   - Ga naar [dashboard.render.com](https://dashboard.render.com)

2. **Nieuwe PostgreSQL Database Aanmaken**
   - Klik op "New +" knop rechtsboven
   - Selecteer "PostgreSQL"

3. **Database Configuratie**
   ```
   Name: writgoai-db
   Database: writgoai_production
   User: (automatisch gegenereerd)
   Region: Frankfurt (EU Central)
   PostgreSQL Version: 15
   Plan: Starter ($7/maand) of Free (voor testen)
   ```

4. **Database Aanmaken**
   - Klik op "Create Database"
   - Wacht tot de database volledig provisioned is (1-2 minuten)

5. **Connection Strings Ophalen**
   - Ga naar de database dashboard
   - Zoek de "Connections" sectie
   - Noteer de volgende connection strings:
     - **Internal Database URL**: Voor gebruik binnen Render services
     - **External Database URL**: Voor lokale toegang

### Optie B: Via render.yaml (Automatisch)

De database wordt automatisch aangemaakt wanneer je de `render.yaml` file in je repository hebt en een nieuwe service maakt.

De configuratie in `render.yaml` zorgt voor:
- PostgreSQL 15 database
- Frankfurt region (GDPR compliant)
- Automatische koppeling met web service
- Starter plan (of Free voor testing)

### Connection Strings Uitleg

**Internal Database URL** (gebruikt in productie):
```
postgresql://writgoai_db_user:xxxx@dpg-xxxx-a.frankfurt-postgres.render.com/writgoai_production
```

**External Database URL** (gebruikt voor lokale migraties):
```
postgresql://writgoai_db_user:xxxx@dpg-xxxx-a.frankfurt-postgres.render.com/writgoai_production?sslmode=require
```

## ðŸŒ Stap 2: Web Service Setup

### Via Render Dashboard

1. **Nieuwe Web Service Aanmaken**
   - Klik op "New +" knop
   - Selecteer "Web Service"

2. **Repository Verbinden**
   - Selecteer "Connect a repository"
   - Kies GitHub
   - Zoek en selecteer `Mikeyy1405/Writgoai.nl`
   - Klik "Connect"

3. **Service Configuratie**
   ```
   Name: writgoai-app
   Region: Frankfurt
   Branch: main (of je productie branch)
   Root Directory: (laat leeg)
   Runtime: Node
   Build Command: cd nextjs_space && yarn install && yarn prisma generate && yarn build
   Start Command: cd nextjs_space && yarn start
   Plan: Starter ($7/maand) of Free (met beperkingen)
   ```

4. **Advanced Settings**
   - **Auto-Deploy**: Enable (automatisch deployen bij git push)
   - **Health Check Path**: `/api/health`

### Via render.yaml (Automatisch)

Als je repository een `render.yaml` file heeft in de root:
1. Klik op "New +" â†’ "Blueprint"
2. Selecteer je repository
3. Render detecteert automatisch de `render.yaml`
4. Klik "Apply" om alle services aan te maken

## ðŸ” Stap 3: Environment Variables Setup

### Vereiste Environment Variables

Voeg de volgende environment variables toe in de Render service settings:

#### Database (Automatisch gekoppeld via render.yaml)
```bash
DATABASE_URL=[Auto-linked from writgoai-db]
```

#### NextAuth (Authenticatie)
```bash
NODE_ENV=production
NEXTAUTH_URL=https://writgoai.nl
NEXTAUTH_SECRET=[Auto-generated by Render]
```

> **Genereer NEXTAUTH_SECRET lokaal met:**
> ```bash
> openssl rand -base64 32
> ```

#### AIML API (Vereist)
```bash
AIML_API_KEY=your-aiml-api-key-here
AIML_API_BASE_URL=https://api.aimlapi.com/v1
```

> **Verkrijg API key op:** https://aimlapi.com/

#### AWS S3 (Vereist voor file uploads)
```bash
AWS_BUCKET_NAME=your-s3-bucket-name
AWS_ACCESS_KEY_ID=your-aws-access-key-id
AWS_SECRET_ACCESS_KEY=your-aws-secret-access-key
AWS_REGION=eu-west-1
```

> **Setup AWS S3:**
> 1. Maak S3 bucket aan in AWS Console
> 2. CreÃ«er IAM user met S3 permissions
> 3. Genereer Access Keys

#### Optioneel: Bol.com Affiliate API
```bash
BOLCOM_CLIENT_ID=your-bolcom-client-id
BOLCOM_CLIENT_SECRET=your-bolcom-client-secret
```

> **Aanmelden op:** https://partnerprogramma.bol.com/

#### Optioneel: DataForSEO API (Legacy)
```bash
DATAFORSEO_USERNAME=your-dataforseo-username
DATAFORSEO_PASSWORD=your-dataforseo-password
```

> **Aanmelden op:** https://dataforseo.com/

### Environment Variables Toevoegen in Render

1. Ga naar je Web Service dashboard
2. Klik op "Environment" in het linkermenu
3. Scroll naar "Environment Variables"
4. Klik "Add Environment Variable"
5. Voer Key en Value in
6. Klik "Save Changes"

**Let op:** Na het toevoegen van environment variables wordt de service automatisch opnieuw gedeployed!

## ðŸ”„ Stap 4: Database Migraties

### Optie A: Automatisch tijdens Deploy (Aanbevolen)

Database migraties worden automatisch uitgevoerd door het `deploy.sh` script tijdens de build:

```bash
yarn prisma migrate deploy
```

### Optie B: Handmatig via Render Shell

1. Ga naar je Web Service dashboard
2. Klik op "Shell" in het menu
3. Voer uit:
   ```bash
   cd nextjs_space
   yarn prisma migrate deploy
   ```

### Optie C: Vanaf Lokale Machine

1. Kopieer de External Database URL
2. Voeg toe aan je lokale `.env`:
   ```bash
   DATABASE_URL="postgresql://user:pass@host.render.com/db?sslmode=require"
   ```
3. Voer migraties uit:
   ```bash
   cd nextjs_space
   yarn prisma migrate deploy
   ```

## ðŸš€ Stap 5: Deployen

### Methode 1: Via Dashboard (Manual Deploy)

1. Ga naar je Web Service dashboard
2. Klik op "Manual Deploy" rechtsboven
3. Selecteer "Deploy latest commit"
4. Wacht tot de build compleet is (5-10 minuten)

### Methode 2: Via Git Push (Auto Deploy)

Als Auto-Deploy is ingeschakeld:

```bash
git add .
git commit -m "Deploy to Render"
git push origin main
```

Render detecteert automatisch de push en start een nieuwe deploy.

### Deployment Proces Monitoring

1. **Build Logs Bekijken**
   - Ga naar "Logs" tab in de service dashboard
   - Volg de real-time build output

2. **Build Stages**
   - Installing dependencies (2-3 min)
   - Generating Prisma Client (30s)
   - Running migrations (30s-2min)
   - Building Next.js (2-4 min)
   - Starting application (30s)

3. **Success Indicatoren**
   - âœ… Build completed successfully
   - âœ… Health check passing
   - âœ… Service live at URL

## ðŸŒ Stap 6: Custom Domain Setup (writgoai.nl)

### In Render Dashboard

1. **Custom Domain Toevoegen**
   - Ga naar je Web Service
   - Klik op "Settings"
   - Scroll naar "Custom Domains"
   - Klik "Add Custom Domain"
   - Voer in: `writgoai.nl` en `www.writgoai.nl`

2. **DNS Configuratie Instructies**
   Render geeft je DNS records die je moet toevoegen:
   
   **Voor apex domain (writgoai.nl):**
   ```
   Type: A
   Name: @
   Value: 216.24.57.1
   ```
   
   **Voor www subdomain:**
   ```
   Type: CNAME
   Name: www
   Value: writgoai-app.onrender.com
   ```

### In je DNS Provider (TransIP/Cloudflare/etc.)

1. Log in op je DNS provider
2. Ga naar DNS management voor writgoai.nl
3. Voeg de A record toe voor apex domain
4. Voeg de CNAME record toe voor www subdomain
5. Save changes

### SSL Certificaat

Render genereert automatisch een gratis SSL certificaat via Let's Encrypt:
- Duurt 1-5 minuten na DNS propagatie
- Automatische renewal elke 90 dagen
- HTTPS wordt automatisch afgedwongen

### Verificatie

1. Wacht 5-15 minuten voor DNS propagatie
2. Test met: `dig writgoai.nl` en `dig www.writgoai.nl`
3. Bezoek https://writgoai.nl in je browser
4. Controleer of SSL certificaat actief is (groene slotje)

## ðŸŒ± Stap 7: Database Seeding (Optioneel)

Als je bestaande data wilt importeren:

### Van lokale backup

1. **Exporteer lokale data:**
   ```bash
   pg_dump -U username -d writgo_db > backup.sql
   ```

2. **Importeer in Render database:**
   ```bash
   psql "postgresql://user:pass@host.render.com/db?sslmode=require" < backup.sql
   ```

### Via Render Shell

1. Ga naar Web Service â†’ Shell
2. Upload je SQL file
3. Voer uit:
   ```bash
   cd nextjs_space
   yarn prisma db execute --file=../backup.sql
   ```

## ðŸ” Troubleshooting

### âŒ Build Failed

**Symptoom:** Build faalt met dependency errors

**Oplossing:**
```bash
# Lokaal testen
cd nextjs_space
rm -rf node_modules
yarn install
yarn prisma generate
yarn build
```

Als het lokaal werkt:
- Check of `yarn.lock` committed is
- Verify Node version (18.x vereist)
- Check build logs voor specifieke errors

### âŒ Database Connection Error

**Symptoom:** "Can't reach database server"

**Diagnose:**
1. Check of DATABASE_URL correct is ingesteld
2. Verify database is "Available" in Render
3. Test connection:
   ```bash
   yarn prisma db execute --stdin <<< "SELECT 1;"
   ```

**Oplossing:**
- Gebruik Internal Database URL in production
- Verify database region matches service region
- Check database logs in Render

### âŒ App Crashes on Start

**Symptoom:** Service start en crashed direct

**Diagnose:**
1. Check application logs:
   - Ga naar "Logs" tab
   - Zoek naar error messages bij start
   
2. Verify all environment variables:
   ```bash
   # In Render Shell
   echo $DATABASE_URL
   echo $NEXTAUTH_SECRET
   echo $AIML_API_KEY
   ```

**Common Issues:**
- Missing environment variables
- Invalid DATABASE_URL format
- Port binding issues (moet 3000 zijn)

### âš ï¸ Slow Performance

**Symptoom:** Applicatie reageert traag

**Oorzaken:**
- Free tier heeft beperkte resources
- Database queries niet geoptimaliseerd
- Onvoldoende RAM voor cache

**Oplossingen:**
1. Upgrade naar Starter plan ($7/maand)
2. Enable database connection pooling
3. Implement caching (Redis optioneel)
4. Optimize Prisma queries

## ðŸ’° Kosten Overzicht

### Minimum Setup (Gratis Tier)

| Component | Plan | Kosten | Beperkingen |
|-----------|------|--------|-------------|
| Web Service | Free | â‚¬0/maand | 750u/maand, suspended bij inactiviteit |
| PostgreSQL | Free | â‚¬0/maand | 90 dagen data retention, 1GB storage |
| **Totaal** | | **â‚¬0/maand** | Limited resources, niet voor productie |

### Productie Setup (Aanbevolen)

| Component | Plan | Kosten | Resources |
|-----------|------|--------|-----------|
| Web Service | Starter | â‚¬7/maand | 512MB RAM, always-on, no suspension |
| PostgreSQL | Starter | â‚¬7/maand | 1GB RAM, 10GB storage, 90 dagen backups |
| SSL Certificate | Gratis | â‚¬0/maand | Auto-renewing Let's Encrypt |
| **Totaal** | | **~â‚¬14/maand** | Geschikt voor kleine tot middelgrote apps |

### Enterprise Setup (Schaalbaar)

| Component | Plan | Kosten | Resources |
|-----------|------|--------|-----------|
| Web Service | Standard | â‚¬25/maand | 2GB RAM, 2 CPU, dedicated resources |
| PostgreSQL | Standard | â‚¬45/maand | 4GB RAM, 50GB storage, dagelijkse backups |
| CDN/Caching | Optioneel | â‚¬10+/maand | CloudFlare, Redis caching |
| **Totaal** | | **~â‚¬70+/maand** | High-traffic production apps |

> **Tip:** Start met Starter plan en upgrade op basis van metrics en traffic.

## âœ… Pre-Deployment Checklist

- [ ] Alle API keys verzameld en getest
- [ ] Database schema up-to-date in repository
- [ ] Environment variables gedocumenteerd
- [ ] Build succesvol lokaal getest
- [ ] Prisma migrations up-to-date
- [ ] Next.js production build succesvol
- [ ] Health check endpoint geÃ¯mplementeerd (`/api/health`)
- [ ] Backup van lokale database gemaakt (indien migreren)

## âœ… Deployment Checklist

- [ ] Render account aangemaakt en geverifieerd
- [ ] PostgreSQL database aangemaakt in Frankfurt
- [ ] Web service aangemaakt en verbonden met repository
- [ ] Alle environment variables ingesteld
- [ ] Database migraties succesvol uitgevoerd
- [ ] Eerste deployment succesvol afgerond
- [ ] Health checks passing
- [ ] Custom domain (writgoai.nl) geconfigureerd
- [ ] SSL certificaat actief
- [ ] DNS records correct ingesteld

## âœ… Post-Deployment Checklist

- [ ] Applicatie bereikbaar via https://writgoai.nl
- [ ] Login functionaliteit werkt (NextAuth)
- [ ] Database queries werken
- [ ] File uploads werken (AWS S3)
- [ ] AI features werken (AIML API)
- [ ] Affiliate links werken (Bol.com)
- [ ] Auto-deploy ingeschakeld
- [ ] Monitoring en alerting ingesteld
- [ ] Backup strategie geÃ¯mplementeerd
- [ ] Team members toegevoegd aan Render project

## ðŸ“Š Monitoring & Logs

### Render Dashboard Metrics

1. **CPU & Memory Usage**
   - Ga naar service dashboard
   - Bekijk "Metrics" tab
   - Monitor resource usage over tijd

2. **Response Times**
   - Track average response time
   - Identify slow endpoints
   - Set up alerts voor downtimes

3. **Build History**
   - Bekijk vorige deployments
   - Check build durations
   - Rollback indien nodig

### Application Logs

```bash
# Real-time logs in Render Shell
cd nextjs_space
yarn prisma studio  # Database browser
```

### External Monitoring (Optioneel)

- **Sentry**: Error tracking en performance monitoring
  - https://sentry.io
  - Integreer met Next.js
  
- **New Relic**: APM en infrastructure monitoring
  - https://newrelic.com
  - Free tier beschikbaar

- **Uptime Robot**: Uptime monitoring
  - https://uptimerobot.com
  - Gratis voor 50 monitors

## ðŸ”„ Updates & Maintenance

### Auto-Deploy Configuratie

Als Auto-Deploy enabled is:
- Elke push naar main branch triggert nieuwe deploy
- Build logs beschikbaar in real-time
- Health checks voorkomen bad deploys

### Manual Deploy

Voor kritieke updates:
1. Ga naar Web Service
2. Klik "Manual Deploy"
3. Selecteer specific commit of branch
4. Monitor build logs

### Rollback Procedure

Bij problemen na deploy:
1. Ga naar Web Service dashboard
2. Klik "Events" of "Deploys"
3. Zoek laatste werkende deploy
4. Klik "Redeploy" op die versie
5. Wacht tot rollback compleet is

## ðŸ”’ Security Best Practices

### Environment Variables
- âŒ Commit nooit secrets in git
- âœ… Gebruik Render's environment variables
- âœ… Rotate API keys regelmatig
- âœ… Gebruik `sync: false` voor sensitive data

### Database Security
- âœ… Gebruik internal database URL in production
- âœ… Enable SSL voor external connections
- âœ… Beperk IP access indien mogelijk
- âœ… Regelmatige backups (automatisch met Starter plan)

### Application Security
- âœ… HTTPS enforced via Render
- âœ… NEXTAUTH_SECRET moet strong zijn (32+ chars)
- âœ… Rate limiting implementeren
- âœ… Input validation op alle endpoints
- âœ… CORS policy correct configureren

### API Key Rotation

Roteer keys elke 90 dagen:
1. Genereer nieuwe API key bij provider
2. Voeg toe als nieuwe environment variable
3. Test applicatie met nieuwe key
4. Verwijder oude key uit Render
5. Revoke oude key bij provider

### Database Backups

**Automatisch (Starter plan):**
- Dagelijkse backups laatste 7 dagen
- 90 dagen retention voor point-in-time recovery

**Handmatig:**
```bash
# Download backup
pg_dump "DATABASE_URL" > backup-$(date +%Y%m%d).sql

# Upload to S3 voor long-term storage
aws s3 cp backup-*.sql s3://your-backup-bucket/
```

## ðŸ“š Support & Resources

### Render Documentatie
- Official Docs: https://render.com/docs
- Node.js Guide: https://render.com/docs/deploy-node-express-app
- PostgreSQL Guide: https://render.com/docs/databases

### Render Community
- Community Forum: https://community.render.com
- Discord: https://discord.gg/render
- GitHub Discussions: https://github.com/render-examples/

### Status & Incidents
- Status Page: https://status.render.com
- Subscribe voor incident notifications

### Writgo AI Specifiek
- Repository: https://github.com/Mikeyy1405/Writgoai.nl
- Issues: https://github.com/Mikeyy1405/Writgoai.nl/issues

---

## ðŸŽ‰ Gefeliciteerd!

Je hebt Writgo AI succesvol gedeployed op Render! 

Voor vragen of problemen:
1. Check eerst deze documentatie
2. Bekijk Render logs voor errors
3. Zoek in Render community forum
4. Open issue in GitHub repository

**Happy Deploying! ðŸš€**
